<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - 바퀴를 만들자. Package를 제작법</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #1C1C1F;color: #E4E4E4;" >
<div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
<h1 class="title_header_title">바퀴를 만들자. Package를 제작법</h1>
<p class="title_header_summary">node.js의 풍부한 npm과 라이브러리들을 package를 통해 격리하고 사용하는 방법을 배워본다.</p>
</div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars0.githubusercontent.com/u/623157?v=3&s=460" alt="이재호">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            이재호

                        </h4>
                        acidsound<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="toc_location"></div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.085039)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,4.422047)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.085039)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.085039)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.085039)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.340157)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.085039)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.085039)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.170079)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.170079)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.381102)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,1.360630)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.445669)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.340157)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.255118)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.085039)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.425197)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.765354)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.765354)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.680315)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.085039)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.255118)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.085039)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.085039)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.340157)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.085039)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.085039)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.085039)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.170079)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.170079)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.085039)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.085039)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.170079)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.255118)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.085039)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.085039)'>twitter-bootstrap</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.085039)'>express</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.085039)'>express.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.170079)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.170079)'>backend</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.085039)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.085039)'>visualization</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.085039)'>reactjs</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.255118)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,0.765354)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.170079)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.680315)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.085039)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.085039)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.085039)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.170079)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.170079)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.170079)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.085039)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.170079)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.085039)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.085039)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.085039)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.085039)'>meteor.js</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.085039)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.085039)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.085039)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.085039)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.085039)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.170079)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.170079)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.085039)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.085039)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.085039)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.085039)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.085039)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.085039)'>immutable</a>

    </div>
</div>
    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <h1>[Core Meteor] 바퀴를 만들자. Package를 제작법</h1>

<p>어플리케이션을 만들다 보면 반복적으로 사용하면서 재사용하는 코드들이 있는데</p>

<p>node.js 의 경우는 <a href="http://npmjs.com">npm</a>이 Meteor는 <a href="https://atmospherejs.com">atmosphere</a>에서 관리하고 있다.</p>

<p>그런데 개인적으로만 사용하거나 소스 공개를 할 수 없는 (ex. 외주 SI) 경우 해당 프로젝트에서만 유효한 package를 만들어야 한다.</p>

<p>package를 만드는 법은 생각보다 어렵지 않은데,
가령 anonymous라는 사용자(이는 meteor 계정을 말한다)가 sample1이라는 패키지를 만들고자 한다면
해당 패키지를 적용하고자 하는 프로젝트 안에서</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">meteor create --package anonoymous:sample1
</code></pre></div>
<p>명령을 통해 생성할 수 있다.</p>

<h2>npm 서버 패키지 만들기</h2>

<p>npm 패키지의 경우 <a href="https://github.com/meteorhacks/npm">meteorhacks:npm</a>과 같은 패키지를 사용하는 경우를 많이 보았는데
직접 패키지를 만들면 더 관리하기 쉽고 안전하게 운용할 수 있다.</p>

<p>예로 요즘 realtime database로 새롭게 떠오르고 있는 <a href="http://rethinkdb.com/">rethinkdb</a>의 npm을 만들어본다면</p>

<p><code>meteor create --package &lt;your namespace&gt;:rethinkdb</code> 식으로 하자</p>

<p>생성하고 난 뒤 <code>cd package/rethinkdb</code> 하여 내용을 보면 packages.js, rethinkdb.js, rethinkdb-test.js, README.md 이렇게 네 개의 파일이 있는데 우리는 package.js, rethinkdb.js 만 수정해본다.</p>

<p>rethinkdb.js는 간단하다.  공식 문서(http://rethinkdb.com/docs/install-drivers/javascript/)처럼 r이란 전역명을 사용하기 위해</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">r</span> <span class="o">=</span> <span class="nx">Npm</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;rethinkdb&#39;</span><span class="p">);</span>
</code></pre></div>
<p>이렇게 한 줄 정의하자.</p>

<p>package.js<a href="http://docs.meteor.com/#/full/packagejs">(http://docs.meteor.com/#/full/packagejs)</a> 는 몇군데 손을 봐야하는데</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Package</span><span class="p">.</span><span class="nx">describe</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;spectrum:rethinkdb&#39;</span><span class="p">,</span>
  <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span>
  <span class="c1">// Brief, one-line summary of the package.</span>
  <span class="nx">summary</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="c1">// URL to the Git repository containing the source code for this package.</span>
  <span class="nx">git</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="c1">// By default, Meteor will default to using README.md for documentation.</span>
  <span class="c1">// To avoid submitting documentation, set this field to null.</span>
  <span class="nx">documentation</span><span class="o">:</span> <span class="s1">&#39;README.md&#39;</span>
<span class="p">});</span>

<span class="cm">/* 추가 시작: 해당 npm명과 사용할 버전명을 key/value형태로 넣는다. */</span>
<span class="nx">Npm</span><span class="p">.</span><span class="nx">depends</span><span class="p">({</span>
  <span class="s1">&#39;rethinkdb&#39;</span><span class="o">:</span> <span class="s1">&#39;2.1.0&#39;</span>
<span class="p">});</span>
<span class="cm">/* 추가 끝 */</span>

<span class="nx">Package</span><span class="p">.</span><span class="nx">onUse</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">//  api.versionsFrom(&#39;1.1.0.3&#39;);</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;ecmascript&#39;</span><span class="p">);</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">addFiles</span><span class="p">(</span><span class="s1">&#39;rethinkdb.js&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">);</span> <span class="cm">/* server 에서 사용할 것을 명시한다 */</span>
  <span class="nx">api</span><span class="p">.</span><span class="kr">export</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">);</span> <span class="cm">/* rethink.js 에서 받아온 전역변수를 서버에 노출한다 */</span>
<span class="p">});</span>
</code></pre></div>
<p><code>Npm.depends</code> 부분과 <code>api.addFiles</code>에 <code>, &#39;server&#39;</code> 부분을 추가하고
rethink.js에서 사용한 <strong>r</strong>을 <code>api.export</code>를 이용하여 서버쪽에 노출한다.</p>

<p><code>meteor shell</code> 로 제대로 들어갔는지 확인해보자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ meteor shell

Welcome to the server-side interactive shell!

Tab completion is enabled for global variables.

Type .reload to restart the server and the shell.
Type .exit to disconnect from the server and leave the shell.
Type .help for additional help.

&gt; r
{ [Function]
  expr: [Function],
  js: [Function],
  http: [Function],
  json: [Function],
  error: [Function],
  random: [Function],
  binary: [Function],
  row: { [Function] args: [], optargs: {} },
  table: [Function],
  db: [Function],
  dbCreate: [Function],
  dbDrop: [Function],
  dbList: [Function],
  tableCreate: [Function],
.....
</code></pre></div>
<p>이렇게 나오면 server쪽에서 <strong>r</strong>로 시작하는 RethinkDB Query를 쓸 수 있다.</p>

<h2>클라이언트 패키지 만들기</h2>

<p>클라이언트의 경우는 서버보다 훨씬 단순하다.</p>

<p>필요한 파일을 추가하고 그것들을 모두 <code>package.js</code>의 <code>api.addFiles</code>에 추가하는 것이 전부다.</p>

<p>javascript 갤러리 라이브러리인 <a href="http://photoswipe.com/">Photoswipe</a>를 패키지로 만들어 보자.</p>

<p>서버와 마찬가지로 패키지를 생성하자</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">meteor create --package &lt;your namespace&gt;:photoswipe
cd packages/photoswipe
</code></pre></div>
<p>역시 packages.js, photoswipe.js, photoswipe-test.js, README.md 이렇게 네 개의 파일이 생겼을 것이다.</p>

<p>photopswipe.js는 지우고 <a href="https://github.com/dimsemenov/PhotoSwipe">https://github.com/dimsemenov/PhotoSwipe</a>으로부터 lib폴더로 clone하자.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git clone https://github.com/dimsemenov/PhotoSwipe.git lib
</code></pre></div>
<p>로 받아온 뒤 lib 경로 아래에 필요한 파일들을 packages.js에 추가한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Package</span><span class="p">.</span><span class="nx">describe</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;yournamespace:photoswipe&#39;</span><span class="p">,</span>
  <span class="nx">summary</span><span class="o">:</span> <span class="s1">&#39;JavaScript gallery, no dependencies.&#39;</span><span class="p">,</span>
  <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
  <span class="nx">git</span><span class="o">:</span> <span class="s1">&#39;https://github.com/acidsound/meteor-photoswipe.git&#39;</span>
<span class="p">});</span>

<span class="nx">Package</span><span class="p">.</span><span class="nx">onUse</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">versionsFrom</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">);</span>
  <span class="nx">api</span><span class="p">.</span><span class="nx">addFiles</span><span class="p">([</span>
    <span class="s1">&#39;lib/dist/photoswipe.css&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lib/dist/default-skin/default-skin.css&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lib/dist/default-skin/default-skin.png&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lib/dist/default-skin/default-skin.svg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lib/dist/default-skin/preloader.gif&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lib/dist/photoswipe.js&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lib/dist/photoswipe-ui-default.js&#39;</span>
  <span class="p">],</span> <span class="s1">&#39;client&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>default skin이랑 js, css, ui-default 를 포함하고 *.min.js 류들은 어짜피 Meteor에서 uglify 하므로 포함할 필요가 없다.</p>

<p>테스트하기전에 <code>meteor add yournamespace:photoswipe</code> 하여 패키지 추가하는 것을 잊지말자.</p>

<h2>Atmosphere에 Deploy하기</h2>

<p>테스트해보고 잘 작동하는지 확인하고 나면 <code>publish</code>로 atmoshpere에 등록한다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">meteor publish --create
</code></pre></div>
<p>그리고 이후에 수정한 내용을 업데이트 할 때엔 packages.js 파일 중</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Package</span><span class="p">.</span><span class="nx">describe</span><span class="p">({</span>
<span class="p">...</span>
  <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
<span class="p">...</span>
<span class="p">});</span>
</code></pre></div>
<p><code>version: &#39;1.0.1&#39;</code> 과 같이 버전 정보를 올려주고</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">meteor publish
</code></pre></div>
<p>를 통해 업데이트 해주자.</p>

        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/javascript">javascript</a>&nbsp;<a href="/tags/meteor">meteor</a>&nbsp;<a href="/tags/static">static</a>&nbsp;<a href="/tags/assets">assets</a>&nbsp;<a href="/tags/public">public</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>

    <script>
        $('#main_content').toc();
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>